#	uCore with SMP Report
岳士超  
2012011295

--------

1. **完成情况**
> 目前所有程序运行正常，make grade除priority之外全部通过
> 四个核共享一个进程队列，每次进入schedule时上锁，对进程队列处理完后解锁。
> 

2. **困难**
> 1. ``_binary_obj_entryother_start``符号找不到
> > 经过学习其他人的代码，更改Makefile和符号名后解决。但依旧不知道原理是为什么
> 
> 1. 进入sh后会有一个page fault崩溃在0地址处
> > 经过单步跟踪，发现当中断处理后返回idle proc时寄存器ebp所指向的地址上方里所存储的值是零，即返回地址是零。所以会有一个page fault。经过继续单步跟踪后发现在处理sh时的kernel程序在调用一个函数后idle的那个值就被清零了。于是想到应该是使用的内核栈应该是同一个，导致那个内核栈被清空了。再深一步分析发现应该是sh进程在进入内核栈时使用的esp不对，所以会让内核栈重复。而esp是由TSS决定的。因此终于找到了问题的原因。这个bug一共找了两整天才找到。
> 
> 1. 键盘无法使用
> > 寻找了一整天没有找到原因。后来询问助教，助教问我是不是没有没有给APIC发送EOI。一语点醒梦中人。在给``trap_dispatch``增加了EOI后就可以正常使用了
> 
> 1. 只有一个CPU可以抢占线程
> > 因为之前只有一个idle proc，经过改动之后有四个guard proc, 同时有四个current proc这样就可以四个CPU同时抢占进程
> > 

