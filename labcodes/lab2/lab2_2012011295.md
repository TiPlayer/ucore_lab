#	OS Lab2 Report
岳士超
2012011295

--------

## 练习0
1. **填写已有试验**
> 已完成，见代码

2. **列出本试验对应的OS原理的知识点**
> 1. 练习一所包括的知识点有: 
> > 页管理系统初始化，页的分配，回收
> > 分配和回收时加强对页表内容的理解，比如标志位等
> > 回收时同时要注意将相邻空闲页表合并
>
> 2. 练习二所包括的知识点有: 
> > 页表地址转换，其中包括对一级页表和二级页表之间关系的理解
> > 如何创建一个新的二级页表
> > 一个逻辑地址如何转化成为二级页表所对应的虚拟地址等等
> 
> 3. 练习三所包括的知识点有: 
> > 页的回收，其中包括
> > uCore API的调用，TLB的理解等
>

## 练习1

*实现 first-fit 连续物理内存分配算法*

> **default\_init\_memmap**
> > 首先为每一个页面设置Property位
> > 然后将page_link加入free_list中
> 
> **default\_alloc\_pages**
> > 首先寻找一个property大于等于n的空闲段
> > 然后将该页和之后的一共n页从链表中删除
> > 设置Reserved位，清空Property位
> > 如果空闲段长度大于n，设置之后第n页相关属性
> > 将nr_free减n
> 
> **default\_free\_pages**
> > 首先寻找该页面在list中的位置
> > 将该页和之后的页共n页按顺序加入到list中
> > 为这n页设置相关属性
> > 合并前后的空闲页
> 
> **你的first fit算法是否有进一步的改进空间**  
> > 我认为可以不用每次将这n个空闲页加入到链表中
> > 只有当需要添加的时候才将空闲页的起始加入到链表中
> 


## 练习2
1. **实现寻找虚拟地址对应的页表项**
> 首先通过Page Director找到对应的PDE，然后检查该PDE所对应的PTE是否存在，如果不存在则根据参数选择是否创建新的PTE并设置好相关参数。最后返回该PTE所在的虚拟内存地址

2. **请描述页目录项（Pag Director Entry）和页表（Page Table Entry）中每个组成部分的含义和以及对ucore而言的潜在用处**
> PDE: PTE物理地址 | PTE\_P | PTE\_W | PTE\_U  
> PTE: Page物理地址 | PTE\_P | PERMISSION  
> 其中物理地址是帮助寻找相应的二级页表／页的物理地址  
> PTE\_P 表示相应二级页表/页是否存在  
> PTE\_W 表示相应二级页表是否可写  
> PTE\_U 表示相应二级页表是否可被用户访问 

3. **如果ucore执行过程中访问内存，出现了页访问异常，请问硬件要做哪些事情？**
> 由于当前程度只存在内核态，不存在用户态。所以如果发生了页访问异常，首先会在当前的栈中压入依次trapframe中的x86指定项(eflags, cs, eip, errorcode), 然后查找idt跳转到中断处理程序 


## 练习3
1. **释放某虚地址所在的页并取消对应二级页表项的映射**
> 首先通过Page Director找到对应的PDE，然后检查该PDE所对应的PTE是否存在，如果不存在则根据参数选择是否创建新的PTE并设置好相关参数。最后返回该PTE所在的虚拟内存地址

2. **数据结构Page的全局变量（其实是一个数组）的每一项与页表中的页目录项和页表项有无对应关系？如果有，其对应关系是什么**
> 有对应关系, 每一个page代表了一个实际的物理页, 而PTE的每一项指向了一个实际的物理页。多个PTE可以同时指向一个物理页

3. **如果希望虚拟地址与物理地址相等，则需要如何修改lab2，完成此事？ 鼓励通过编程来具体完成这个问题**
> 可以在alloc_page的时候去alloc那个实际物理地址所在的page，设置对应的PTE指向这个page，这样就可以让物理地址和虚拟地址相等
> 


